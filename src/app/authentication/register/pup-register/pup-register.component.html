<div class="register-container">
  <img src="logo.png" alt="Logo Image" class="register-image">
  <h3 class="register-title">Product/Service Provider</h3>
  <label *ngIf="currentStep === 0">Please provide us with some information about yourself.</label>
  <label *ngIf="currentStep === 1">Please provide us with some information about your company.</label>

  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
    <!-- Step 1: Personal Data -->
    <div *ngIf="currentStep === 0">
      <div class="form-grid">
        <!-- First Column of Inputs -->
        <div class="form-column">
          <mat-form-field appearance="fill">
            <mat-label>Full Name</mat-label>
            <input matInput placeholder="Full Name" formControlName="fullName" />
            <mat-error *ngIf="registerForm.get('fullName')?.hasError('required')">
              Full Name is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Email</mat-label>
            <input matInput placeholder="Email" formControlName="email" />
            <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
              Email is required
            </mat-error>
            <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
              Invalid email format
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Phone Number</mat-label>
            <input matInput placeholder="Phone Number" formControlName="phoneNumber" type="number" />
            <mat-error *ngIf="registerForm.get('phoneNumber')?.hasError('pattern')">
              Phone number must be at least 8 digits
            </mat-error>
            <mat-error *ngIf="registerForm.get('phoneNumber')?.hasError('required')">
              Phone number is required
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Second Column of Inputs -->
        <div class="form-column">
          <mat-form-field appearance="fill">
            <mat-label>City</mat-label>
            <input matInput placeholder="City" formControlName="city" />
            <mat-error *ngIf="registerForm.get('city')?.hasError('required')">
              City is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Address</mat-label>
            <input matInput placeholder="Address" formControlName="address" />
            <mat-error *ngIf="registerForm.get('address')?.hasError('required')">
              Address is required
            </mat-error>
          </mat-form-field>


          <div class="form-column">
            <div class="profile-pic">
              <input type="file" id="profilePic" (change)="onProfileImageSelected($event)" style="display: none;" accept="image/*" />
              <button mat-raised-button class="upload-button" type="button" (click)="triggerFileInput(0)" *ngIf="!imagePreview">
                UPLOAD PROFILE PICTURE (OPTIONAL)
              </button>

              <!-- Image Preview Section -->
              <div class="image-preview" *ngIf="imagePreview">
                <img [src]="imagePreview" alt="Profile Preview" />
                <button mat-icon-button aria-label="Remove Image" class="image-close-btn" type="button" (click)="clearProfileImage()">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
          </div>


        </div>
      </div>
    </div>

    <!-- Step 2: Company Data -->
    <div *ngIf="currentStep === 1">
      <div class="form-grid">
        <!-- First Column of Inputs -->
        <div class="form-column">
          <mat-form-field appearance="fill">
            <mat-label>Email</mat-label>
            <input matInput placeholder="Company Email" formControlName="companyEmail" />
            <mat-error *ngIf="registerForm.get('companyEmail')?.hasError('required')">
              Email is required
            </mat-error>
            <mat-error *ngIf="registerForm.get('companyEmail')?.hasError('email')">
              Invalid email format
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Password</mat-label>
            <input
              matInput
              [type]="hidePassword ? 'password' : 'text'"
              placeholder="Password"
              formControlName="password"
            />
            <button mat-icon-button type="button" (click)="togglePasswordVisibility()" matSuffix>
              <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
              Password is required
            </mat-error>
          </mat-form-field>


          <mat-form-field appearance="fill">
            <mat-label>Confirm Password</mat-label>
            <input
              matInput
              [type]="hideConfirmPassword ? 'password' : 'text'"
              placeholder="Confirm Password"
              formControlName="confirmPassword"
            />
            <button mat-icon-button type="button" (click)="toggleConfirmPasswordVisibility()" matSuffix>
              <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-error *ngIf="registerForm.get('confirmPassword')?.hasError('passwordMismatch')">
              Passwords do not match
            </mat-error>
          </mat-form-field>



          <mat-form-field appearance="fill">
            <mat-label>Phone Number</mat-label>
            <input matInput placeholder="Phone Number" formControlName="companyPhoneNumber" type="number" />
            <mat-error *ngIf="registerForm.get('companyPhoneNumber')?.hasError('required')">
              Phone Number is required
            </mat-error>
          </mat-form-field>



          <div class="form-column">
            <input type="file" id="companyPictures" (change)="onCompanyImageSelected($event)" style="display: none;" accept="image/*" multiple />
            <button mat-raised-button class="upload-button" type="button" (click)="triggerFileInput(1)">
              UPLOAD COMPANY PICTURES (OPTIONAL)
            </button>

            <!-- Image Preview and Cropping Section -->
            <div class="image-preview" *ngIf="companyImages.length > 0">
              <div *ngFor="let image of companyImages; let i = index" class="company-image-preview">
                <img [src]="image.cropped || image.src" alt="Company Preview {{i + 1}}" />
                <button mat-icon-button aria-label="Remove Image" class="image-close-btn" type="button" (click)="clearCompanyImage(i)">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
          </div>


        </div>


        <!-- Second Column of Inputs -->
        <div class="form-column">
          <mat-form-field appearance="fill">
            <mat-label>Company Name</mat-label>
            <input matInput placeholder="Company Name" formControlName="companyName" />
            <mat-error *ngIf="registerForm.get('companyName')?.hasError('required')">
              Company Name is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>City</mat-label>
            <input matInput placeholder="City" formControlName="companyCity" />
            <mat-error *ngIf="registerForm.get('companyCity')?.hasError('required')">
              City is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Address</mat-label>
            <input matInput placeholder="Company Address" formControlName="companyAddress" />
            <mat-error *ngIf="registerForm.get('companyAddress')?.hasError('required')">
              Address is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Description</mat-label>
            <textarea matInput placeholder="Description" formControlName="description"></textarea>
            <mat-error *ngIf="registerForm.get('description')?.hasError('required')">
              Description is required
            </mat-error>
          </mat-form-field>





        </div>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="button-group">
      <button mat-raised-button class="back-button" *ngIf="currentStep == 0" type="button" [routerLink]="'/register'">
        BACK
      </button>

      <button mat-raised-button class="back-button" id="back-button2" *ngIf="currentStep > 0" type="button" (click)="onBack()">
        BACK
      </button>
      <button mat-raised-button class="next-button" *ngIf="currentStep === 0" type="button" (click)="onNext()">
        NEXT
      </button>
      <button mat-raised-button class="register-button" *ngIf="currentStep === 1" type="submit">
        REGISTER
      </button>
    </div>
  </form>
</div>
